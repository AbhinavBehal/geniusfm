(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{154:function(module,__webpack_exports__,__webpack_require__){"use strict";var F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__),F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7),F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11),F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(12),cheerio__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(58),cheerio__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(cheerio__WEBPACK_IMPORTED_MODULE_4__),Genius=function(){function Genius(e){Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__.a)(this,Genius),this.token=e}return Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_3__.a)(Genius,[{key:"request",value:function(){var e=Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function e(t){var n,a,r;return F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.includes("?")?"https://api.genius.com/".concat(t,"&access_token=").concat(this.token):"https://api.genius.com/".concat(t,"?access_token=").concat(this.token),e.next=3,fetch(n);case 3:return a=e.sent,e.next=6,a.json();case 6:if(!(r=e.sent).error){e.next=9;break}throw new Error("".concat(r.error,": ").concat(r.error_description));case 9:if(200===r.meta.status){e.next=11;break}throw new Error("".concat(r.meta.status,": ").concat(r.meta.message));case 11:return e.abrupt("return",r.response);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"song",value:function(){var e=Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function e(t,n){var a,r,_,s;return F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a='search?q="'.concat(t," - ").concat(n,'"'),e.next=3,this.request(a);case 3:return r=e.sent.hits[0].result.api_path.slice(1),e.next=6,this.request(r);case 6:return _=e.sent,s=_.song,e.abrupt("return",s);case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"annotations",value:function(){var _annotations=Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee3(id,count){var url,response,text,parsed,children,components,referents,annotationMap;return F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return url="https://cors-anywhere.herokuapp.com/https://genius.com/songs/".concat(id,"/embed.js"),_context3.next=3,fetch(url);case 3:return response=_context3.sent,_context3.next=6,response.text();case 6:return text=_context3.sent,parsed=cheerio__WEBPACK_IMPORTED_MODULE_4___default.a.load(eval(text.slice(text.indexOf("JSON.parse("),text.lastIndexOf("))")+1))),children=parsed(".rg_embed_body > p").contents(),components=[],_context3.next=12,this.referents(id,count);case 12:return referents=_context3.sent,annotationMap=new Map,referents.forEach(function(e){annotationMap.set(""+e.id,e.annotations[0].body.html)}),children.each(function(e){var t=children[e];if("text"===t.type&&0!==t.data.trim().length)components.push({lyrics:t.data});else if("a"===t.name){var n=cheerio__WEBPACK_IMPORTED_MODULE_4___default.a.load(t);components.push({lyrics:n("a").removeAttr("href target onclick").html(),annotation:annotationMap.get(t.attribs["data-id"])})}}),_context3.abrupt("return",components);case 17:case"end":return _context3.stop()}},_callee3,this)}));function annotations(e,t){return _annotations.apply(this,arguments)}return annotations}()},{key:"referents",value:function(){var e=Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function e(t,n){var a;return F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="referents?song_id=".concat(t,"&text_format=html&per_page=").concat(n>0?n:1),e.next=3,this.request(a);case 3:return e.abrupt("return",e.sent.referents);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"scrapeLyrics",value:function(){var e=Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function e(t){var n,a,r,_;return F_Files_IdeaProjects_geniusfm_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://cors-anywhere.herokuapp.com/".concat(t),e.next=3,fetch(n);case 3:return a=e.sent,e.next=6,a.text();case 6:return r=e.sent,_=cheerio__WEBPACK_IMPORTED_MODULE_4___default.a.load(r),e.abrupt("return",_(".lyrics").text().trim());case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),Genius}();__webpack_exports__.a=Genius},155:function(e,t,n){e.exports=n(357)},160:function(e,t,n){},165:function(e,t,n){},167:function(e,t,n){},169:function(e,t,n){},179:function(e,t){},201:function(e,t){},203:function(e,t){},357:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),_=n(153),s=n.n(_),o=(n(160),n(2)),c=n.n(o),i=n(7),u=n(11),l=n(12),m=n(22),d=n(21),p=n(23),f=(n(165),n(167),function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"now-playing"},r.a.createElement("h2",null,"now playing"),r.a.createElement("div",{className:"album-art"},r.a.createElement("div",{className:"album-img"},r.a.createElement("img",{alt:"album art",src:this.props.track.image})),r.a.createElement("div",{className:"info"},r.a.createElement("span",null,r.a.createElement("b",null,this.props.track.title)),r.a.createElement("span",null,"by ",r.a.createElement("b",null,this.props.track.artist)),r.a.createElement("span",null,"on ",r.a.createElement("b",null,this.props.track.album)))),r.a.createElement("div",{className:"lyrics"},this.props.track.lyrics))}}]),t}(a.Component)),h=(n(169),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(d.a)(t).call(this,e))).toggleDetails=function(){n.setState({showDetails:!n.state.showDetails})},n.state={showDetails:!1},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"annotation"},r.a.createElement("div",{className:"lyric ".concat(this.props.annotation?"lyric-has-details":""),onClick:this.toggleDetails,dangerouslySetInnerHTML:{__html:this.props.lyrics}}),this.state.showDetails&&this.props.annotation&&r.a.createElement("div",{className:"details",dangerouslySetInnerHTML:{__html:this.props.annotation}}))}}]),t}(a.Component)),b=n(154);function E(){return(E=Object(i.a)(c.a.mark(function e(t){var n,a,r,_,s,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user="+t+"&api_key=ceab0ddfa3c5e0db1ea1d39e720aea8d&format=json");case 2:return n=e.sent,e.next=5,n.json();case 5:if(!(a=e.sent)||!a.error){e.next=9;break}return console.log(a.message),e.abrupt("return");case 9:if((r=a.recenttracks.track[0])["@attr"]&&r["@attr"].nowplaying){e.next=13;break}return console.log("not currently playing anything"),e.abrupt("return");case 13:return _=new b.a("8JMxsTZnH_D5fDAfKnzzGb5d82Ro7-nH7oLScAppfPVjuLXKZmdp7BUH7pVA0dZG"),e.next=16,_.song(r.name,r.artist["#text"]);case 16:return s=e.sent,e.next=19,_.annotations(s.id,s.annotation_count);case 19:return o=e.sent,e.abrupt("return",{title:s.title,album:s.album.name,artist:s.primary_artist.name,image:r.image[r.image.length-1]["#text"],referents:o});case 21:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var O=function(e){return E.apply(this,arguments)},g=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(d.a)(t).call(this,e))).usernameSubmitted=function(e){e.preventDefault(),n.loadInfo()},n.loadInfo=Object(i.a)(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(n.state.value);case 2:(t=e.sent).lyrics=t.referents.map(function(e,t){return r.a.createElement(h,{key:t,lyrics:e.lyrics,annotation:e.annotation})}),n.setState({submitted:!0,track:t});case 5:case"end":return e.stop()}},e,this)})),n.usernameChanged=function(e){n.setState({value:e.target.value}),""===e.target.value&&n.setState({submitted:!1})},n.state={value:"",submitted:!1,track:null},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"app"},r.a.createElement("h1",null,"genius.fm"),r.a.createElement("form",{className:"user-search",onSubmit:this.usernameSubmitted},r.a.createElement("input",{type:"text",placeholder:"your last.fm username",onChange:this.usernameChanged})),r.a.createElement("div",{className:"container ".concat(this.state.submitted?"move-up":"")},this.state.submitted&&r.a.createElement(f,{track:this.state.track})))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(g,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[155,2,1]]]);
//# sourceMappingURL=main.3e69fc0d.chunk.js.map