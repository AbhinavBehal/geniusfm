(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{162:function(module,__webpack_exports__,__webpack_require__){"use strict";var F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(163),F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5),F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__),F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11),F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14),F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(15),cheerio__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(97),cheerio__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(cheerio__WEBPACK_IMPORTED_MODULE_5__),Genius=function(){function Genius(e){Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_3__.a)(this,Genius),this.token=e}return Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_4__.a)(Genius,[{key:"request",value:function(){var e=Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__.a)(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark(function e(t){var n,a,r;return F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.includes("?")?"https://api.genius.com/".concat(t,"&access_token=").concat(this.token):"https://api.genius.com/".concat(t,"?access_token=").concat(this.token),e.next=3,fetch(n);case 3:return a=e.sent,e.next=6,a.json();case 6:if(!(r=e.sent).error){e.next=9;break}throw new Error("".concat(r.error,": ").concat(r.error_description));case 9:if(200===r.meta.status){e.next=11;break}throw new Error("".concat(r.meta.status,": ").concat(r.meta.message));case 11:return e.abrupt("return",r.response);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"song",value:function(){var e=Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__.a)(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark(function e(t,n){var a,r,_,s,o,c,i;return F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.lastIndexOf("-"),r=t.slice(0,a>0?a:t.length).trim(),_='search?q="'.concat(r," ").concat(n,'"&per_page=1'),e.next=6,this.request(_);case 6:if((s=e.sent.hits)&&0!==s.length){e.next=9;break}return e.abrupt("return",null);case 9:return o=s[0].result.api_path.slice(1),e.next=12,this.request(o);case 12:return c=e.sent,i=c.song,e.abrupt("return",i);case 15:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"annotations",value:function(){var _annotations=Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__.a)(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark(function _callee3(id,count){var url,response,text,parsed,children,components,referents,annotationMap,currentLine,addLine;return F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return url="https://genius.com/songs/".concat(id,"/embed.js"),_context3.next=3,fetch(url);case 3:return response=_context3.sent,_context3.next=6,response.text();case 6:return text=_context3.sent,parsed=cheerio__WEBPACK_IMPORTED_MODULE_5___default.a.load(eval(text.slice(text.indexOf("JSON.parse("),text.lastIndexOf("))")+1))),children=parsed(".rg_embed_body > p").contents(),components=[],_context3.next=12,this.referents(id,count);case 12:return referents=_context3.sent,annotationMap=new Map,referents.forEach(function(e){annotationMap.set(e.api_path.substr(e.api_path.lastIndexOf("/")+1),e.annotations[0].body.html)}),currentLine={lyrics:"",annotation:null},addLine=function(){0!==currentLine.lyrics.trim().length&&components.push(currentLine),currentLine={lyrics:"",annotation:null}},children.each(function(e){var t=children[e];if("br"===t.name)addLine();else if("text"===t.type)currentLine.lyrics+=t.data;else if("i"===t.name&&t.children.length>0&&"text"===t.children[0].type)currentLine.lyrics+=t.children[0].data;else{addLine();var n=cheerio__WEBPACK_IMPORTED_MODULE_5___default.a.load(t)("a");n.html()&&components.push({lyrics:n.removeAttr("href target onclick").html(),annotation:annotationMap.get(n.attr("data-id"))})}}),addLine(),_context3.abrupt("return",components);case 20:case"end":return _context3.stop()}},_callee3,this)}));function annotations(e,t){return _annotations.apply(this,arguments)}return annotations}()},{key:"referents",value:function(){var e=Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__.a)(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark(function e(t,n){var a,r,_,s,o,c,i;return F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n>(a=50))){e.next=15;break}r=Math.ceil(n/a),_=[],s=1;case 5:if(!(s<=r)){e.next=14;break}return o="referents?song_id=".concat(t,"&text_format=html&per_page=").concat(a,"&page=").concat(s),e.next=9,this.request(o);case 9:c=e.sent.referents,_.push.apply(_,Object(F_Files_IdeaProjects_geniusfm_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__.a)(c));case 11:++s,e.next=5;break;case 14:return e.abrupt("return",_);case 15:return i="referents?song_id=".concat(t,"&text_format=html&per_page=").concat(n>0?n:1),e.next=18,this.request(i);case 18:return e.abrupt("return",e.sent.referents);case 19:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),Genius}();__webpack_exports__.a=Genius},164:function(e,t,n){e.exports=n(389)},169:function(e,t,n){},200:function(e,t,n){},201:function(e,t,n){},202:function(e,t,n){},211:function(e,t){},233:function(e,t){},235:function(e,t){},389:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),_=n(160),s=n.n(_),o=(n(169),n(5)),c=n.n(o),i=n(11),l=n(14),u=n(15),m=n(25),d=n(24),p=n(26),b=n(161),h=(n(200),n(201),function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"now-playing"},r.a.createElement("div",null,r.a.createElement("h2",null,"now playing"),r.a.createElement("div",{className:"album-art"},r.a.createElement("div",{className:"album-img"},r.a.createElement("img",{alt:"album art",src:this.props.track.image})),r.a.createElement("div",{className:"info"},r.a.createElement("span",null,r.a.createElement("b",null,this.props.track.title)),r.a.createElement("span",null,"by ",r.a.createElement("b",null,this.props.track.artist)),r.a.createElement("span",null,"on ",r.a.createElement("b",null,this.props.track.album))))),r.a.createElement("div",{className:"lyrics"},this.props.track.lyrics))}}]),t}(a.Component)),f=(n(202),function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(d.a)(t).call(this,e))).toggleDetails=function(){n.setState({showDetails:!n.state.showDetails})},n.state={showDetails:!1},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"annotation"},r.a.createElement("div",{className:"lyric ".concat(this.props.annotation?"lyric-has-details":""),onClick:this.toggleDetails,dangerouslySetInnerHTML:{__html:this.props.lyrics}}),this.state.showDetails&&this.props.annotation&&r.a.createElement("div",{className:"details",dangerouslySetInnerHTML:{__html:this.props.annotation}}))}}]),t}(a.Component)),E=new(n(162).a)("8JMxsTZnH_D5fDAfKnzzGb5d82Ro7-nH7oLScAppfPVjuLXKZmdp7BUH7pVA0dZG");function g(){return(g=Object(i.a)(c.a.mark(function e(t){var n,a,r,_,s;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user="+t+"&api_key=ceab0ddfa3c5e0db1ea1d39e720aea8d&format=json&limit=1");case 2:return n=e.sent,e.next=5,n.json();case 5:if(!(a=e.sent)||!a.error){e.next=8;break}throw new Error("No one found with that username");case 8:if((r=a.recenttracks.track[0])&&r["@attr"]&&r["@attr"].nowplaying){e.next=11;break}throw new Error("You're not currently playing anything");case 11:return e.next=13,E.song(r.name,r.artist["#text"]);case 13:if((_=e.sent)&&_.primary_artist.name.trim()===r.artist["#text"].trim()){e.next=16;break}throw new Error("Couldn't find lyrics for ".concat(r.name));case 16:return e.next=18,E.annotations(_.id,_.annotation_count);case 18:return s=e.sent,e.abrupt("return",{title:_.title,album:_.album.name,artist:_.primary_artist.name,image:_.album.cover_art_url,referents:s});case 20:case"end":return e.stop()}},e)}))).apply(this,arguments)}var O=function(e){return g.apply(this,arguments)},P=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(d.a)(t).call(this,e))).usernameSubmitted=function(e){e.preventDefault(),localStorage.setItem("username",n.state.username),n.loadInfo()},n.loadInfo=Object(i.a)(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({submitted:!1,loading:!0,error:null}),e.prev=1,console.log(n.state.username),e.next=5,O(n.state.username);case 5:(t=e.sent).lyrics=t.referents.map(function(e,t){return r.a.createElement(f,{key:t,lyrics:e.lyrics,annotation:e.annotation})}),n.setState({submitted:!0,track:t,loading:!1,error:null}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),n.setState({loading:!1,error:e.t0.message});case 13:case"end":return e.stop()}},e,null,[[1,10]])})),n.usernameChanged=function(e){n.setState({username:e.target.value,error:null})},n.state={username:"",submitted:!1,track:null,loading:!1,error:null},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=localStorage.getItem("username");e&&this.setState({username:e},this.loadInfo)}},{key:"render",value:function(){return r.a.createElement("div",{className:"app"},r.a.createElement("h1",null,"genius.fm"),this.state.loading?r.a.createElement(b.ScaleLoader,{loading:this.state.loading}):r.a.createElement("form",{className:"user-search ".concat(this.state.submitted?"submitted":""),onSubmit:this.usernameSubmitted},r.a.createElement("input",{type:"text",placeholder:"your last.fm username",value:this.state.username,onChange:this.usernameChanged})),this.state.error&&r.a.createElement("p",{className:"error"},this.state.error),r.a.createElement("div",{className:"container ".concat(this.state.submitted?"move-up":"")},this.state.submitted&&r.a.createElement(h,{track:this.state.track})))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(P,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[164,1,2]]]);
//# sourceMappingURL=main.df7c2c37.chunk.js.map